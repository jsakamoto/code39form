{"version":3,"sources":["index.ts"],"names":[],"mappings":"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","file":"index.js","sourcesContent":["\r\nnamespace Code39Form {\r\n\r\n    interface InputLine {\r\n        id: number;\r\n        text: string;\r\n    }\r\n\r\n    interface StorageService {\r\n        get(key: string): string;\r\n        put(key: string, value: string): void;\r\n    }\r\n\r\n    // Initialize storage service.\r\n    let storageService = initializeStorageService();\r\n\r\n    let inputLinesJson = storageService.get('inputLines') || '[{\"id\":1,\"text\":\"\"}]';\r\n    let inputLines = JSON.parse(inputLinesJson) as InputLine[];\r\n\r\n    let $inputLinesContainer = $('.input-lines-container');\r\n\r\n    // Prepare template.\r\n    let source = $(\"#line-template\").html();\r\n    let template = Handlebars.compile(source);\r\n\r\n    // Initial display view.\r\n    inputLines.forEach(inputLine => {\r\n        let html = template(inputLine);\r\n        $inputLinesContainer.append(html);\r\n        updateBarcodeImage(inputLine);\r\n    });\r\n    updateUIState();\r\n\r\n    // Wire up event handlers.\r\n\r\n    $(document).on('click', '.add-input-line', () => {\r\n        let newId = inputLines.map(l => l.id).reduce((prev, current) => Math.max(prev, current)) + 1;\r\n        let newLine = { id: newId, text: '' };\r\n        let html = template(newLine);\r\n        $inputLinesContainer.append(html);\r\n\r\n        inputLines.push(newLine);\r\n        storageService.put('inputLines', JSON.stringify(inputLines));\r\n        updateUIState();\r\n        setFocus(newId);\r\n    });\r\n\r\n    $(document).on('click', '.remove-input-line:not(.disabled)', (e) => {\r\n        let $inputLine = $(e.target).closest('.input-line');\r\n        let lineId = $inputLine.data('line-id');\r\n        if ($('.input-line').length < 2) return;\r\n        if (!confirm('Are you sure?')) {\r\n            setFocus(lineId);\r\n            return;\r\n        }\r\n\r\n        $inputLine.remove();\r\n\r\n        let inputLine = inputLines.filter(line => line.id == lineId).pop();\r\n        let index = inputLines.indexOf(inputLine);\r\n        inputLines.splice(index, 1);\r\n\r\n        storageService.put('inputLines', JSON.stringify(inputLines));\r\n        updateUIState();\r\n        setFocus((inputLines[index] || inputLines[inputLines.length - 1]).id);\r\n    });\r\n\r\n    $(document).on('change keydown paste', '.input-line .control input:text', (e) => {\r\n        let $inputLine = $(e.target).closest('.input-line');\r\n        let lineId = $inputLine.data('line-id') as number;\r\n        let input = e.target as HTMLInputElement;\r\n        setTimeout(() => {\r\n            let newText = input.value.toUpperCase();\r\n            let inputLine = inputLines.filter(line => line.id == lineId).pop();\r\n            if (inputLine != undefined && inputLine.text != newText) {\r\n                inputLine.text = newText;\r\n                updateBarcodeImage(inputLine);\r\n                storageService.put('inputLines', JSON.stringify(inputLines));\r\n            }\r\n\r\n        }, 0);\r\n    });\r\n\r\n    function updateBarcodeImage(inputLine: InputLine): void {\r\n        let $inputLine = $('div[data-line-id=' + inputLine.id + ']');\r\n        $('.barcode-image', $inputLine).html('').barcode(inputLine.text, 'code39', { barWidth: 3, showHRI: false });\r\n        $('.human-readable .content', $inputLine).text(inputLine.text);\r\n    }\r\n\r\n    function updateUIState(): void {\r\n        $('.remove-input-line').toggleClass('disabled', inputLines.length < 2);\r\n    }\r\n\r\n    function setFocus(id: number): void {\r\n        $(`#barcode-input-${id}`).focus();\r\n    }\r\n\r\n    function initializeStorageService(): StorageService {\r\n\r\n        let enableLocalStorage = (typeof (localStorage) !== 'undefined');\r\n        let storageService = null as StorageService;\r\n        if (enableLocalStorage == true) {\r\n            storageService = {\r\n                get: (key: string) => localStorage.getItem(key),\r\n                put: (key: string, value: string) => localStorage.setItem(key, value)\r\n            };\r\n        }\r\n        else {\r\n            storageService = {\r\n                get: (key: string) => $.cookie(key),\r\n                put: (key: string, value: string) => $.cookie(key, value)\r\n            };\r\n        }\r\n        return storageService;\r\n    }\r\n\r\n\r\n    // Global error handling.\r\n    window.onerror = <any>function (message: string, url?: string, lineNumber?: number, columnNumber?: number, exception?: Error) {\r\n        exception = exception || <any>{ message, stack: `${url || '- unknown souce file -'}(${lineNumber}:${columnNumber})` };\r\n        alert(exception);\r\n    };\r\n}"]}